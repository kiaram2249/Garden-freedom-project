<!DOCTYPE html>
<html>
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
        <style>
            /* CSS */
            html {
                height: 100%;
                margin: 0;
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: #F0F0F0;
            }
            body {
                height: 100%;
                margin: 0;
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: #F0F0F0;
            }
            canvas {
                border: 1px solid #000;
            }
        </style>
        <title>Falling Shapes Game</title>
    </head>
    <body>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
          -->
        <script src = "https://q5js.org/q5.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.10.0/addons/p5.sound.min.js"></script>
        <script src="https://p5play.org/v3/planck.min.js"></script>
        <script src="https://p5play.org/v3/p5play.js"></script>
        <script>

        let setting;
        let settingY = 0;
        let basket;
        let shapes;
        let score = 0;
        let gameOver = false;


        let banana;
        let bananaImg;
        let trash;
        let trashImg;

        function preload() {
            setting = loadImage("wood.png");
            bananaImg = loadImage("fruits.png");
            trashImg = loadImage("trash.png");
        }
        function setup() {
            createCanvas(600, 400);
            basket = new Sprite(300, 370, 100, 20, 'static');
            basket.color = 'brown';
            shapes = new Group();
            textSize(20);

            // banana = new Sprite();
            // banana.image = bananaImg;
            // trash = new Sprite();
            // trash.image = trashImg;
        }

        function draw() {
            background(240);
            // image(banana, 50, 50);
            // image(trash, 50, 50);
            image(setting, 0, settingY, width, height);
            image(setting, 0, settingY + height, width, height);
            settingY--;
            if (settingY < -height) settingY = 0;

            if (gameOver) {
                fill(255, 0, 0);
                textAlign(CENTER, CENTER);
                textSize(40);
                text("GAME OVER", width / 2, height / 2);
                return;
            }
            basket.x = constrain(mouseX, 50, 550);

            if (frameCount % 30 === 0) {
                let shape = new Sprite(shapes);
                shape.x = random(50, 550);
                shape.y = -20;
                shape.vel.y = random(2, 5);

                if (random() < 0.3) {
                    // Deadly (trashbag)
                    shape.image = trashImg;
                    shape.isDeadly = true;
                    shape.scale = 0.1;
                } else {
                    // Safe (banana)
                    shape.image = bananaImg;
                    shape.isDeadly = false;
                    shape.scale = 0.3;
                }

                // Resize image-basded shape
                // shape.scale = 0.2; // smaller size
            }

            for (let shape of shapes) {
                if (shape.overlapping(basket)) {
                    if (shape.isDeadly) {
                        gameOver = true;
                    } else {
                        score++;
                    }
                    shape.remove();
                } else if (shape.y > height + 30) {
                    shape.remove();
                }
            }

            fill(0);
            text("Score: " + score, 10, 20);
        }

        </script>
    </body>
</html>
